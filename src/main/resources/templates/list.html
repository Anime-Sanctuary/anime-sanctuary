<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>게시판 리스트</title>
  <link rel="stylesheet" href="/default.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    // 데이터를 테이블에 렌더링하는 함수
    function renderBoardList(data) {
      const tableBody = $("#boardListBody");
      tableBody.empty(); // 기존 내용을 초기화

      if (data.length === 0) {
        tableBody.append('<tr><td colspan="5" class="center">데이터가 없습니다.</td></tr>');
        return;
      }

      $.each(data, function(index, post) {
        const row = `
          <tr>
            <td class="center">${index + 1}</td>
            <td><a href="/board/read/${post.id}">${post.title}</a></td>
            <td class="center">${post.author}</td>
            <td class="center">${post.contents}</td>
            <td class="center">${new Date(post.createdAt).toLocaleDateString()}</td>
          </tr>
        `;
        tableBody.append(row);
      });
    }

    // 게시판 데이터를 가져오는 함수
    function getJson() {
      // AJAX 기본 형태
      $.ajax({
        url: "/api/posts",
        type: "get",
        dataType: "json", // 생략 가능
        success: function(data, success, xhr) {
          // 요청이 성공했을 때 할 행동
          // console.log(data); // API 응답 데이터
          renderBoardList(data);
        },
        error: function(xhr, status, error) {
          console.error('Error:', error);
        }
      });
    }

    // 페이지 로드 시 데이터를 가져오는 함수 호출
    $(document).ready(function() {
      getJson();
    });
  </script>
</head>
<body>
<div id="container">
  <h1>[ 게시판 - 리스트 ]</h1>
  <div class="right">
    <label for="searchText">검색</label>
    <input type="search" id="searchText" name="searchText">
    <input type="button" value="검색" onclick="getJson()">
  </div>
  <p>
  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>제목</th>
        <th>작성자</th>
        <th>내용</th>
        <th>작성일</th>
      </tr>
    </thead>
    <tbody id="boardListBody">
      <!-- 데이터를 동적으로 추가 -->
    </tbody>
  </table>
  <p>
  <div class="center">
    <input type="button" onclick="location.href='/'" value="메인으로">
    <input type="button" onclick="location.href='/board/write'" value="글쓰기">
  </div>
</div>
</body>
</html>
