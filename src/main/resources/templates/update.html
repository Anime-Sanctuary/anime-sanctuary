<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>게시글 수정</title>
  <link rel="stylesheet" href="/default.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      // URL에서 게시글 ID 추출
      const postId = window.location.pathname.split('/').pop(); // 마지막 슬래시 뒤의 값 가져오기

      $('#updateForm').submit(function(event) {
        event.preventDefault();

        var formData = {
            title: $('input[name="title"]').val(),
            contents: $('textarea[name="contents"]').val(),
            author: $('input[name="author"]').val(),
            password: $('input[name="password"]').val()
          };

        $.ajax({
          url: `/api/posts/${postId}`,  // 게시글 ID를 포함한 URL
          type: "PUT",
          data: JSON.stringify(formData),
          contentType: "application/json",
          success: function(response) {
            alert('글이 성공적으로 수정되었습니다.');
            window.location.href = `/board/read/${postId}`; // 수정된 게시글로 이동
          },
          error: function(xhr, status, error) {
            alert('글 수정에 실패했습니다. 오류 메시지: ' + xhr.responseText);
            console.error('Error:', error);
          }
        });
      });

      // 서버에서 기존 게시글 데이터를 가져와 폼에 채워 넣기
      fetch(`/api/posts/${postId}`)
        .then(response => response.json())
        .then(data => {
          $('input[name="title"]').val(data.title);
          $('textarea[name="contents"]').val(data.contents);
          $('input[name="author"]').val(data.author);
        })
        .catch(error => {
          console.error('Error fetching post data:', error);
          alert('게시글 데이터를 불러오는 데 실패했습니다.');
        });
    });
  </script>  
</head>
<body>
<div id="container">
  <h1>[ 게시판 - 글수정 ]</h1>
  <form id="updateForm">
    <table>
      <tr>
        <th>제목</th>
        <td>
          <input type="text" name="title" required>
          <div class="error" id="titleError"></div>
        </td>
      </tr>
      <tr>
        <th>내용</th>
        <td>
          <textarea rows="10" cols="30" name="contents" required></textarea>
          <div class="error" id="contentsError"></div>
        </td>
      </tr>
      <tr>
        <th>작성자</th>
        <td>
          <input type="text" name="author" required>
        </td>
      </tr>
      <tr>
        <th>비밀번호</th>
        <td>
          <input type="password" name="password" required>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="text-align: center;">
          <input type="submit" value="수정하기">
        </td>
      </tr>
    </table>
  </form>
</div>
</body>
</html>
